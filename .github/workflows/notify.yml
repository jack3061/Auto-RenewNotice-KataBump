name: Simple Notify

on:
  schedule:
    # æ¯ 3 å¤©è¿è¡Œä¸€æ¬¡ (åŒ—äº¬æ—¶é—´æ—©ä¸Š 8 ç‚¹)
    - cron: '0 0 */3 * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨ç‚¹æŒ‰é’®æµ‹è¯•

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'

      - name: Install Dependencies
        run: pip install requests

      - name: Send Telegram Notification
        env:
          TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
          TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
        shell: python
        run: |
          import requests
          import os
          
          # ç›´æ¥åœ¨ yaml é‡Œå†™ Python ä»£ç ï¼Œä¸ç”¨æ‹…å¿ƒæ‰¾ä¸åˆ°æ–‡ä»¶
          token = os.environ.get("TG_BOT_TOKEN")
          chat_id = os.environ.get("TG_CHAT_ID")
          
          if not token or not chat_id:
            print("âŒ é”™è¯¯: æœªæ£€æµ‹åˆ° Secrets é…ç½®ï¼Œè¯·æ£€æŸ¥ GitHub ä»“åº“è®¾ç½®ã€‚")
            exit(1)
            
          text = (
              "âš ï¸ <b>Katabump ç»­æœŸæé†’</b>\n\n"
              "ğŸ“… å·²ç»è¿‡å» 3 å¤©äº†ï¼ŒæœåŠ¡å™¨å³å°†åˆ°æœŸï¼\n"
              "ğŸ‘‰ è¯·ç«‹å³ç™»å½• Renewï¼š\n"
              "https://dashboard.katabump.com/"
          )
          
          url = f"https://api.telegram.org/bot{token}/sendMessage"
          data = {"chat_id": chat_id, "text": text, "parse_mode": "HTML"}
          
          try:
            response = requests.post(url, json=data)
            print(f"âœ… é€šçŸ¥å‘é€çŠ¶æ€: {response.status_code}")
            print(response.text)
          except Exception as e:
            print(f"âŒ å‘é€å¤±è´¥: {e}")
